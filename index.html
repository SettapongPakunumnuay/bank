<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POP MART Auto Bot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 360px;
      margin: auto;
      padding: 20px;
    }
    img {
      width: 100px;
      display: block;
      margin: 0 auto 10px;
    }
    h2 {
      font-size: 18px;
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    select, input[type="date"] {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    button {
      background: #e60012;
      color: white;
      width: 100%;
      padding: 10px;
      margin-top: 15px;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    textarea {
      margin-top: 10px;
      width: 100%;
      height: 100px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <img src="icon.jpg" alt="POP MART Logo" />
  <h2>Popmart AutoBot by bankkkiizz V1.11</h2>

  <label>Branch</label>
  <select id="branch">
    <option>Terminal 21</option>
    <option>Central Ladprao</option>
    <option>Fashion Island</option>
    <option>Centralworld</option>
    <option>MEGABANGNA</option>
    <option>Siam Square</option>
    <option>Central Pattaya</option>
    <option>Seacon Square</option>
    <option>Central Westgate</option>
    <option>Central Chiangmai</option>
    <option>Iconsiam</option>
    <option>Central Rama 3</option>
    <option>Central Rama 2</option>
    <option>Central Pinklao</option>
    <option>Central Rattanathibet</option>
    <option>Central Phuket</option>
  </select>

  <label>Date</label>
  <input type="date" id="date" />

  <label>Time</label>
  <select id="time"></select>

  <label>
    <input type="checkbox" id="autoRun" />
    ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏ó
  </label>

  <button onclick="saveSettings()">Save</button>
  <button onclick="generateBookmarklet()">Copy Bookmarklet</button>

  <textarea id="bookmarkletOutput" readonly placeholder="Bookmarklet will appear here..."></textarea>

  <script>
    const timeSelect = document.getElementById("time");
    for (let hour = 10; hour <= 20; hour++) {
      ["30", "00"].forEach((m, i) => {
        if (hour === 10 && i === 0) return;
        const h = hour.toString().padStart(2, "0");
        const t = `${h}:${m}`;
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        timeSelect.appendChild(opt);
      });
    }
    timeSelect.appendChild(new Option("21:00", "21:00"));

    window.onload = () => {
      const config = JSON.parse(localStorage.getItem("config")) || {};
      if (config) {
        document.getElementById("branch").value = config.targetBranch || "";
        document.getElementById("date").value = config.targetDate || "";
        document.getElementById("time").value = config.targetTime || "";
        document.getElementById("autoRun").checked = config.autoRun || false;
      }
    };

    function saveSettings() {
      const config = {
        targetBranch: document.getElementById("branch").value,
        targetDate: document.getElementById("date").value,
        targetTime: document.getElementById("time").value,
        autoRun: document.getElementById("autoRun").checked
      };
      localStorage.setItem("config", JSON.stringify(config));
      alert("‚úÖ Settings Saved");
    }

    function generateBookmarklet() {
      const branch = document.getElementById("branch").value;
      const date = document.getElementById("date").value;
      const time = document.getElementById("time").value;

      const payload = `(function(){
if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô?'))return;
const targetBranch="${branch}",targetDate="${date}",targetTime="${time}";
const waitFor=(c,b,i=300,t=18e5)=>{const s=Date.now();const l=setInterval(()=>{const r=c();if(r){clearInterval(l);b(r)}else if(Date.now()-s>t){clearInterval(l);console.warn("‚è± Timeout")}},i)};
waitFor(()=>[...document.querySelectorAll("button")].find(btn=>btn.innerText.trim()==="Register"&&!btn.disabled),
registerBtn=>{registerBtn.click();console.log("‚úÖ Register");
waitFor(()=>[...document.querySelectorAll(".branch-item")].find(el=>el.innerText.includes(targetBranch)&&!el.classList.contains("full")),
branchEl=>{branchEl.click();console.log("üè¢ Branch:",targetBranch);
waitFor(()=>[...document.querySelectorAll("button,div,span")].find(el=>el.innerText.trim().toLowerCase()==="next"&&!el.disabled&&!el.classList.contains("disabled")&&getComputedStyle(el).pointerEvents!=="none"),
nextBtn=>{nextBtn.click();console.log("‚û°Ô∏è Next");
const day=new Date(targetDate).getDate().toString();
waitFor(()=>{const e=document.getElementById("day"+day);if(e)return e;
return[...document.querySelectorAll(".calendar-cell,.day-selectable")].find(el=>el.innerText.trim()===day&&!el.classList.contains("day-selected"))},
dayEl=>{dayEl.click();console.log("üìÖ Day:",day);
waitFor(()=>[...document.querySelectorAll(".time-btn")].find(btn=>btn.innerText.trim()===targetTime&&!btn.disabled),
timeBtn=>{setTimeout(()=>{timeBtn.click();console.log("üïí Time:",targetTime);
waitFor(()=>{const c=document.getElementById("confirmTime");return c&&getComputedStyle(c).display!=="none"},
confirmBtn=>{confirmBtn.click();console.log("‚úÖ Confirm")},300,60000)},300)})})})})})})();`;

      const bookmarklet = "javascript:" + encodeURIComponent(payload);
      const textarea = document.getElementById("bookmarkletOutput");
      textarea.value = bookmarklet;
      textarea.select();
      document.execCommand("copy");
      alert("üìã Bookmarklet copied! ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Bookmark Safari ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
    }
  </script>
</body>
</html>
